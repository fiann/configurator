"use strict";(function(b){var a={name:"hProduct Microformat Parser Plugin",id:"hProduct-plugin",version:0.1,vendor:"jsHub.org",type:"microformat"};jsHub.trigger("plugin-initialization-start",a);a.eventHandler=function c(h){jsHub.trigger("hproduct-parse-start",h);var d,g,e,j,i;d=jsHub.logger;if(h&&h.data&&h.data.context){g=h.data.context;}if(h.timestamp){i=h.timestamp;}e=b(".hproduct",g);e=e.not(e.find(".hproduct"));j={products:[]};var f={".brand":"product-brand",".category":"product-category",".description":"product-description",".fn":"product-name",".product-id":"product-id",".price":"product-price"};e.each(function(k,q){var n={};var l=b(q);b.each(f,function(u,r){var s,t;s=l.find(u);s=s.not(s.find(".hproduct"));t=s.getMicroformatPropertyValue(true);if(t!==null){n[r]=t;}});var m=b(".attribute",q);m.each(function(){var u=b(this).excerptValueClassData(),t,v,r;if(u!==null){t=u.type;v=u.value;n.attributes=(n.attributes||{});r=b.makeArray(n.attributes[t]);b.merge(r,b.makeArray(v));var w=[];for(var s=0;s<r.length;s++){if(b.inArray(r[s],w)===-1){w.push(r[s]);}}if(w.length===1){w=r[0];}n.attributes[t]=w;}});var p=b("img.photo",q);p.each(function(){var r=b(this).attr("src");if(r!==null){n["product-photo"]=b.makeArray(n["product-photo"]);n["product-photo"].push(r);if(n["product-photo"].length===1){n["product-photo"]=n["product-photo"][0];}}});var o=b("a.url",q);o.each(function(){var r=b(this).attr("href");if(r!==null){n["product-url"]=b.makeArray(n["product-url"]);n["product-url"].push(r);if(n["product-url"].length===1){n["product-url"]=n["product-url"][0];}}});jsHub.trigger("hproduct-data-found",{count:k+1,element:q,data:n});jsHub.trigger("product-view",n,i);j.products.push(n);});jsHub.trigger("hproduct-parse-complete",j);return;};jsHub.bind("page-view",a);jsHub.bind("content-updated",a);jsHub.trigger("plugin-initialization-complete",a);})(jQuery);
"use strict";(function(b){var a={name:"hPage Microformat Parser Plugin",id:"hPage-plugin",version:0.1,vendor:"jsHub.org",type:"microformat"};jsHub.trigger("plugin-initialization-start",a);var c=function c(i){jsHub.trigger("hpage-parse-start",i);var e,h,f,d,g;e=jsHub.logger;if(i&&i.data&&i.data.context){h=i.data.context;}f=b(".hpage",h);f=f.not(f.find(".hpage"));d={};g={".name":"page-name",".title":"page-title",".referrer":"page-referrer",".type":"page-type",".fragment":"page-fragment"};f.each(function(j,p){var n={};var k=b(p);b.each(g,function(t,q){var r,s;r=k.find(t);r=r.not(r.find(".hpage"));s=r.getMicroformatPropertyValue(true);if(s!==null){n[q]=s;n[q+"-source"]=a.id;}});b.extend(true,d,n);var m=[],o=b(".category",p);o=o.not(o.find(".hpage .category"));m=o.excerptMultipleValues();if(m!==null){n["page-category"]=m;n["page-category-source"]=a.id;d["page-category"]=(d["page-category"]||[]);b.each(m,function(q,r){if(b(d["page-category"]).index(r)===-1){d["page-category"].push(r);}});}var l=b(".attribute",p);l.each(function(){var t=b(this).excerptValueClassData(),s,u,q;if(t!==null){s=t.type;u=t.value;d.attributes=(d.attributes||{});q=b.makeArray(d.attributes[s]);b.merge(q,b.makeArray(u));var v=[];for(var r=0;r<q.length;r++){if(b.inArray(q[r],v)===-1){v.push(q[r]);}}if(v.length===1){v=q[0];}d.attributes[s]=v;}});jsHub.trigger("hpage-node-found",{count:j+1,element:p,data:n});});if(d["page-name"]){jsHub.trigger("hpage-found",{context:h,hpage:d});}else{d=null;}jsHub.trigger("hpage-parse-complete");return d;};jsHub.bind("page-view",a.id,c);jsHub.bind("content-updated",a.id,c);jsHub.trigger("plugin-initialization-complete",a);})(jQuery);